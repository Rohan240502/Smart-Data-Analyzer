<!DOCTYPE html>
<html lang="en">
<head>
    <meta charset="UTF-8">
    <title>Smart Data Analyzer</title>

    <link rel="stylesheet" href="{{ url_for('static', filename='css/style.css') }}">
    <script src="https://cdn.jsdelivr.net/npm/chart.js"></script>
</head>

<body>
<div class="container">

    <h1>ðŸ“Š Smart Data Analyzer</h1>
    <p class="subtitle">Upload a CSV file to clean, analyze & visualize data</p>

    <div class="card">
        <form action="/upload" method="post" enctype="multipart/form-data">
            <input type="file" name="file" required>
            <button type="submit">Upload & Analyze</button>
        </form>
    </div>

    {% if tables %}
    <div class="card">
        <h2>Cleaned Data Preview</h2>
        {{ tables | safe }}
        <a href="{{ download_link }}">
            <button class="secondary">Download Cleaned CSV</button>
        </a>
    </div>
    {% endif %}

    {% if analysis %}
    <div class="card">
        <h2>Data Cleaning Summary</h2>
        <table>
            <tr><th></th><th>Before</th><th>After</th></tr>
            <tr><td>Rows</td><td>{{ analysis.before.rows }}</td><td>{{ analysis.after.rows }}</td></tr>
            <tr><td>Columns</td><td>{{ analysis.before.columns }}</td><td>{{ analysis.after.columns }}</td></tr>
            <tr><td>Missing Values</td><td>{{ analysis.before.missing_total }}</td><td>{{ analysis.after.missing_total }}</td></tr>
        </table>
    </div>

    <div class="card">
        <h2>Missing Values by Column</h2>
        <table>
            <tr><th>Column</th><th>Missing</th></tr>
            {% for col, count in analysis.missing_by_column.items() %}
            <tr><td>{{ col }}</td><td>{{ count }}</td></tr>
            {% endfor %}
        </table>
    </div>
    {% endif %}

    {% if analysis and analysis.chart %}
    <div class="card">
        <h2>{{ analysis.chart.title }}</h2>
        <canvas id="barChart"></canvas>
    </div>

    <script>
        const labels = {{ analysis.chart["labels"] | tojson }};
        const values = {{ analysis.chart["values"] | tojson }};

        new Chart(document.getElementById("barChart"), {
            type: "bar",
            data: {
                labels: labels,
                datasets: [{
                    data: values,
                    backgroundColor: "rgba(54,162,235,0.7)"
                }]
            },
            options: {
                responsive: true,
                plugins: { legend: { display: false } }
            }
        });
    </script>
    {% endif %}

</div>
</body>
</html>
